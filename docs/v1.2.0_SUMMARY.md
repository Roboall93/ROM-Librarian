# ROM Librarian v1.2.0 - Development Summary

## Version Note
This is a major version release (1.2.0) that includes both the v1.1.3 refactoring and new CHD conversion features.

## Changes Made

### 1. New Conversion Tab
**File:** `ui/tabs/conversion_tab.py` (NEW)

**Features:**
- CHD conversion support for CUE/BIN and ISO disc images
- Radio button mode switching (CUE/BIN → CHD vs ISO → CHD)
- Smart BIN file validation for CUE files
- Bulk conversion with progress tracking
- Optional source file deletion after successful conversion
- Integration with chdman.exe via subprocess
- Automatic cleanup of partial CHD files on failure
- 10-minute timeout per conversion

**Key Methods:**
- `refresh_conversion_lists()` - Scans folder for CUE/ISO files
- `_get_bin_files_for_cue()` - Parses CUE files and validates BIN references
- `_perform_conversion()` - Executes chdman subprocess with error handling
- `_find_chdman()` - Locates chdman.exe in app folder or PATH

### 2. CUE File Awareness in Rename Tab
**File:** `ui/tabs/rename_tab.py` (MODIFIED)

**Changes:**
- Added `cue_updates_needed` list to track BIN file renames
- Added `_update_cue_files()` method to update CUE file contents
- Automatically updates FILE references in CUE files after BIN renames
- Logs all CUE updates for transparency

**Code Flow:**
1. During rename, tracks all .bin file renames
2. After all renames complete, calls `_update_cue_files()`
3. Scans for .cue files in same folders
4. Updates FILE references to match new BIN names
5. Logs updates and errors

### 3. CUE File Awareness in DAT Rename Tab
**File:** `ui/tabs/dat_rename_tab.py` (MODIFIED)

**Changes:**
- Same CUE file updating logic as Rename tab
- Added `cue_updates_needed` tracking
- Added identical `_update_cue_files()` method
- Works for DAT-based bulk renaming operations

### 4. Integration Updates
**File:** `ui/tabs/__init__.py` (MODIFIED)
- Added ConversionTab to exports

**File:** `rom_manager.py` (MODIFIED)
- Imported ConversionTab
- Instantiated conversion_tab

**File:** `rom_librarian.spec` (MODIFIED)
- Added chdman.exe to bundled binaries

### 5. Version Update
**File:** `core/constants.py` (MODIFIED)
- Updated VERSION from "1.1.3" to "1.1.4"

### 6. Documentation
**File:** `docs/v1.1.4_RELEASE_NOTES.md` (NEW)
- Complete feature documentation
- Usage instructions
- Technical details
- Known limitations

## Bug Fixes

### CUE/BIN Detection Issue
**Problem:** Conversion tab showed "Error: Missing 1 BIN file(s)" even when BIN files existed.

**Root Cause:** After using Rename tab, CUE files still contained old BIN filenames internally.

**Solution:** 
1. Fixed immediate issue by adding `os.path.basename()` to extract filename from CUE references
2. Prevented future issues by adding automatic CUE file updating to both rename tabs

## Testing Recommendations

### For User Testing:
1. **Conversion Tab:**
   - Load folder with CUE/BIN files
   - Switch between CUE/BIN and ISO modes
   - Verify BIN file detection works
   - Convert a test file (with chdman.exe present)
   - Test "delete source files" option

2. **Rename Tab CUE Updating:**
   - Rename a BIN file that has an associated CUE file
   - Open the CUE file in text editor
   - Verify FILE reference was updated

3. **DAT Rename Tab CUE Updating:**
   - Load a DAT file
   - Rename files that include BIN files with CUE pairs
   - Verify CUE files were updated

## Files Modified Summary

**New Files:**
- ui/tabs/conversion_tab.py
- docs/v1.1.4_RELEASE_NOTES.md
- docs/v1.1.4_SUMMARY.md (this file)

**Modified Files:**
- ui/tabs/rename_tab.py
- ui/tabs/dat_rename_tab.py
- ui/tabs/__init__.py
- rom_manager.py
- rom_librarian.spec
- core/constants.py

## Known Issues / Limitations

1. **chdman Dependency:** Requires external chdman.exe tool
2. **CUE Encoding:** Assumes UTF-8 encoding for CUE files
3. **Timeout:** 10-minute timeout may be insufficient for very large disc images
4. **Existing Mismatched CUE Files:** Users with already-renamed files need to manually fix or re-rename

## Next Steps

1. Test the Conversion tab with real disc images
2. Verify CUE file updating works in both rename tabs
3. Build executable with chdman.exe bundled
4. Update README with v1.1.4 features
5. Create GitHub release with updated executable
