# ROM Librarian v1.2.0 Release Notes

## Major Release

This is a **major release** combining the v1.1.3 refactoring (86.4% code reduction) with significant new features for disc image management.

## New Features

### CHD Conversion Tab
Added a new **Conversion** tab for converting disc images to CHD (Compressed Hunks of Data) format, commonly used with MAME and RetroArch emulators.

**Features:**
- **CUE/BIN → CHD**: Convert PlayStation disc images (and other formats) from CUE/BIN format to CHD
- **ISO → CHD**: Convert ISO disc images to CHD format
- **Smart validation**: Automatically validates that all referenced BIN files exist for CUE files
- **Bulk conversion**: Convert selected files or all files at once
- **Source cleanup**: Optional deletion of source files after successful conversion
- **Progress tracking**: Real-time progress display with detailed error reporting
- **Auto-detection**: Radio buttons auto-refresh file list based on selected format

**Requirements:**
- Requires `chdman.exe` (from MAME tools) in the same folder as ROM Librarian or in system PATH
- `chdman.exe` is now bundled with the ROM Librarian executable

**Usage:**
1. Load a folder containing CUE/BIN or ISO files
2. Navigate to the **Conversion** tab
3. Select conversion mode (CUE/BIN → CHD or ISO → CHD)
4. Click **Refresh** to detect files
5. Select files to convert or use **Convert All**
6. Optionally check "Delete source files after successful conversion"
7. Click **Convert Selected** or **Convert All**

### CUE File Awareness in Rename Tabs

**Critical Improvement:** Both the **Rename** and **DAT Rename** tabs now automatically update CUE file contents when renaming BIN files.

**What this fixes:**
- Previously, renaming a BIN file would leave CUE files pointing to the old filename, causing broken disc images
- CUE files now automatically update their `FILE` references when associated BIN files are renamed
- Ensures CUE/BIN pairs remain valid after bulk renaming operations (both manual and DAT-based)

**How it works:**
1. When you rename a `.bin` file, the system tracks the rename
2. After all renames complete, it scans for `.cue` files in the same folder
3. Updates any `FILE` references inside CUE files to match the new BIN filenames
4. Logs all CUE updates for transparency

**Example:**
```
Before rename:
  - Fear Effect (Europe) (Disc 1).bin
  - Fear Effect (Europe) (Disc 1).cue  [contains: FILE "Fear Effect (Europe) (Disc 1).bin"]

After renaming to "Fear Effect (Disc 1).bin":
  - Fear Effect (Disc 1).bin
  - Fear Effect (Disc 1).cue  [now contains: FILE "Fear Effect (Disc 1).bin"]
```

## Bug Fixes
- Fixed CUE/BIN pairing issues when BIN filenames don't match CUE references
- Improved BIN file detection by extracting basename from paths in CUE files
- Added debug logging for CUE file parsing issues

## Technical Details
- Added `conversion_tab.py` module with full CHD conversion support
- Integrated `chdman.exe` into build process via PyInstaller spec file
- Enhanced both `rename_tab.py` and `dat_rename_tab.py` with `_update_cue_files()` method
- CUE file updates work for both manual renaming and DAT-based renaming
- Uses subprocess for safe external tool execution with timeout handling
- Automatic cleanup of partial CHD files on conversion failure

## Known Limitations
- CHD conversion requires external `chdman.exe` tool (bundled with releases)
- CUE file encoding assumes UTF-8 (handles errors gracefully)
- 10-minute timeout per file for CHD conversion

## What's Included from v1.1.3 Refactoring

For users upgrading from v1.1.2 or earlier, v1.2.0 includes the complete v1.1.3 refactoring:
- 86.4% code reduction (5,803 lines → 788 lines in main file)
- 6 modular tabs extracted for better maintainability
- Improved performance and stability
- Clean architecture with organized folder structure

## Upgrading
This release includes structural changes to the tab system. Clean installation recommended.

---

**Previous Version:** v1.1.3 (Major refactoring)
**Current Version:** v1.2.0 (CHD conversion + CUE file awareness + Refactoring)
